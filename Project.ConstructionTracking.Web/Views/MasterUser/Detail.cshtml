@{
    Layout = "~/Views/Shared/_LayoutSite.cshtml";

    ViewData["Title"] = "Edit User";

    var baseUrl = @ViewBag.baseUrl;
}

@model Project.ConstructionTracking.Web.Models.MUserModel.DetailUserResp
<div class="page-header d-print-none">
    <div class="container-xl">
        <div class="row">
            <div class="col-3">
                <a href="javascript:history.back()" class="btn btn-secondary mb-3">
                    <i class="fas fa-chevron-left"></i> <span>Go Back</span>
                </a>
            </div>
        </div>
    </div>
</div>
<div class="container mt-5">
    <h1>Edit User</h1>
    <hr />
    <div class="row mb-3">
        <div class="col-lg-6">
            <label for="user-name" class="form-label">ชื่อ</label>
            <input type="text" class="form-control" id="user-name" value="@Model.FirstName">
            <span id="user-name-error" class="text-danger"></span>
        </div>
        <div class="col-lg-6">
            <label for="user-last-name" class="form-label">นามสกุล</label>
            <input type="text" class="form-control" id="user-last-name" value="@Model.LastName">
            <span id="user-last-name-error" class="text-danger"></span>
        </div>
    </div>
    <div class="row mb-3">
        <div class="col-lg-6">
            <label for="user-email" class="form-label">อีเมลล์</label>
            <input type="email" class="form-control" id="user-email" value="@Model.Email">
            <span id="user-email-error" class="text-danger"></span>
        </div>
        <div class="col-lg-6">
            <label for="user-mobile" class="form-label">หมายเลขโทรศัพท์</label>
            <input type="tel" class="form-control" id="user-mobile" value="@Model.MobileNo">
            <span id="user-mobile-error" class="text-danger"></span>
        </div>
    </div>
    <hr />
    <div class="row mb-3">
        <div class="col-lg-6">
            <label for="user-bu-id" class="form-label">BU</label>
            <select class="form-control" id="user-bu-id" name="user-bu-id">
                <option value="0">กรุณาเลือก BU</option>
                @foreach (var b in Model.respModel.BUList)
                {
                    if (b.ID == Model.BUID)
                    {
                        <option value="@b.ID" selected>@b.Name</option>
                    }
                    else
                    {
                        <option value="@b.ID">@b.Name</option>
                    }
                }
            </select>
            <span id="user-bu-id-error" class="text-danger"></span>
        </div>
    </div>
    <div class="row mb-3">
        <div class="col-lg-6">
            <label for="user-position" class="form-label">ตำแหน่ง</label>
            <input type="text" class="form-control" id="user-position" value="@Model.JobPosition">
            <span id="user-position-error" class="text-danger"></span>
        </div>
        <div class="col-lg-6">
            <label for="user-role" class="form-label">Role</label>
            <select class="form-control" id="user-role">
                <option value="0">กรุณาเลือก Role</option>
                @foreach (var r in Model.respModel.RoleList)
                {
                    if (r.ID == Model.RoleID)
                    {
                        <option value="@r.ID" selected>@r.Name</option>
                    }
                    else
                    {
                        <option value="@r.ID">@r.Name</option>
                    }
                }
            </select>
            <span id="user-role-error" class="text-danger"></span>
        </div>
    </div>
    <hr />
    <div class="row mb-3">
        <div class="col-lg-6">
            <label for="user-password" class="form-label">รหัสผ่าน</label>
            <input type="password" class="form-control" id="user-password">
            <span id="user-password-error" class="text-danger"></span>
        </div>
        <div class="col-lg-6">
            <label for="user-password-confirm" class="form-label">ยืนยันรหัสผ่าน</label>
            <input type="password" class="form-control" id="user-password-confirm">
            <span id="user-password-confirm-error" class="text-danger"></span>
        </div>
    </div>
    <hr />
    <div class="row mb-3">
        <div class="col-lg-6">
            <label class="form-label"> Mapping Projects</label>
            @foreach (var item in Model.respModel.ProjectList)
            {
                <div style="display: flex; align-items: center;">
                    <!-- Flexbox applied here -->
                    <input type="checkbox" id="checklist-@item.ProjectID" class="checklist-item large-checkbox" data-id="@item.ProjectID" @(item.IsChecked ? "checked" : "") style="width: 20px; height: 20px; margin-right: 10px;" />
                    <label for="checklist-@item.ProjectID" style="font-size: 1.2em;">@item.ProjectName</label>
                </div>
            }
        </div>
    </div>
    <hr />
    <div class="row mb-3">
        <div class="col-lg-6">
            <button id="open-image-btn" class="btn btn-info">
                <i class="fa-solid fa-signature"></i> &nbsp; แสดงรูปภาพลายเซ็นต์
            </button>
        </div>
    </div>
    <hr />
    <div class="d-flex justify-content-end">
        <button id="edit-user-save" class="btn btn-success">
            บันทึก
        </button>
    </div>
</div>

<div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="imageModalLabel">ลายเซ็นต์</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                @if (@Model.ImageSign != null)
                {
                    <img id="signatureImage" src="@baseUrl@Model.ImageSign" alt="ลายเซ็นต์" class="img-fluid">
                }
                else
                {
                    <p>ไม่มีรูปภาพลายเซ็นต์</p>
                }
            </div>
        </div>
    </div>
</div>
@section Scripts {
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="~/js/pages/detailuser.js?version=@DateTime.Now.Ticks.ToString()"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            // Convert PositionList to a JavaScript array
            var positionNames = [
                @foreach(var position in Model.respModel.PositionList)
                {
                    @: "@position.Name",
                }
            ].filter(Boolean); // Remove any undefined or empty values

            // Set the initial value in the input field
            $("#user-position").val("@Model.JobPosition");

            // Apply autocomplete to the input field
            $("#user-position").autocomplete({
                source: positionNames
            });
            var unitId = "@Model.UserID";
            // Initialize userCreate with the UserID (assuming userCreate is defined in your external script)
            detailUser.init(unitId);
        });
    </script>
}

